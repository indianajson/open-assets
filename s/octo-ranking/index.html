<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octo-Ranking (script)</title>
    <link rel="stylesheet" href="../github-markdown-light.css" id="theme-stylesheet">
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        body { 
            padding:20px;
            text-align: justify;
        }
        #content{
            max-width: 800px;
            margin:auto;
        }
        .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: var(--toggle-bg, #f6f8fa);
        border: 1px solid var(--toggle-border, #d0d7de);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            stroke: var(--icon-color, #57606a);
        }

        /* Dark mode variables - Make sure these are defined */
        body.dark-mode {
            --bg-color: #0d1117;
            --text-color: #c9d1d9;
            --toggle-bg: #21262d;
            --toggle-border: #30363d;
            --icon-color: #8b949e;
        }

        /* Explicit dark mode styles for theme toggle */
        body.dark-mode .theme-toggle {
            background: #21262d;
            border-color: #30363d;
        }

        body.dark-mode .theme-toggle svg {
            stroke: #8b949e;
        }
        .download-btn {
            position: fixed;
            top: 20px;
            right: 80px; /* Position to the left of the theme toggle */
            z-index: 1000;
            background: var(--toggle-bg, #f6f8fa);
            border: 1px solid var(--toggle-border, #d0d7de);
            border-radius: 25px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--icon-color, #57606a);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 14px;
            font-weight: 500;
        }

        .download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            text-decoration: none;
            color: var(--icon-color, #57606a);
        }

        .download-btn svg {
            width: 18px;
            height: 18px;
            stroke: var(--icon-color, #57606a);
        }

        /* Dark mode styles for download button */
        body.dark-mode .download-btn {
            background: var(--toggle-bg, #21262d);
            border-color: var(--toggle-border, #30363d);
            color: var(--icon-color, #8b949e);
        }

        body.dark-mode .download-btn svg {
            stroke: var(--icon-color, #8b949e);
        }

  </style>
</head>
<body class="markdown-body">
    <a href="octo-ranking.zip" class="download-btn" id="downloadBtn" download>
    <i data-feather="download"></i>
    <span>Download</span>
    </a>
    <div class="theme-toggle" id="themeToggle">
        <i data-feather="moon"></i>
    </div>
    <br>
  <div id="content"></div>
  <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
  <script>
    document.getElementById('content').innerHTML =
      marked.parse(`
      
# OctoChris' Matchmaking Script
A script by OctoChris to handle ranked PVP matchmaking on Open Net Battle servers.

<img src="preview.jpg">

### What does it do?

This script allows users to enter free (unranked) or ranked matchmaking queues, as well as, view a leaderboard based on performance by their fellow players. The \`Matchmaking Settings\` menu is accessed via the Left Shoulder button. The \`Matchmaking Request\` is accessed by interacting with another plaver.

### How do I install it on my server?

1. Add the \`demo-server/scripts/octo-ranking\` folder from this repository to your \`/scripts\` folder.
2. For any net area you want to enable match making add a string based custom property named \`OctoPVP\` and make the value \`true\`. 

### What improvements were made from the original script by OctoChris?

1. The script is now stand alone and no longer requires ezlibs.
2. The matchmaking settings and matchmaking request menu have been seperated.
3. Activating the menu requires specific button presses (before all buttons would activate the menu).
4. Matchmaking in an area is enabled via a Custom Property (before you had to modify the script). 

### How is rank determined?

Numerical rating (and thus Letter Rank) is calculated using this formula (assuming abandoned matches/disconnections don't count):<br> 
((((Ranked Wins - Ranked Losses) ÷ Ranked Games Overall) × 0.5) + 0.5) × 50000 = Rating

50000 is the maximum ELO rating a player can achieve.

This is a conversion table between the numerical rating and the letter rank: 

<img src="ranking.png">

### Credit

Original Script - OctoChris<br>
Sword Emote during Battle - [Keristero](https://github.com/Keristero/)<br>
Other Improvements - [Indiana](https://github.com/indianajson/)
      
      `);
  </script>
  <script>
    //Script to handle Light/Dark Mode

        // Initialize Feather icons
        feather.replace();
        
        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const themeStylesheet = document.getElementById('theme-stylesheet');
        
        // Check for saved theme preference or respect OS preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        // Set initial theme
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            document.body.classList.add('dark-mode');
            themeStylesheet.href = '../github-markdown-dark.css';
            themeToggle.innerHTML = feather.icons.sun.toSvg();
        }
        
        // Toggle theme function
        function toggleTheme() {
        const body = document.body;
        const themeToggle = document.getElementById('themeToggle');
        const downloadBtn = document.getElementById('downloadBtn');
        const themeStylesheet = document.getElementById('theme-stylesheet');
        
        if (body.classList.contains('dark-mode')) {
            // Switch to light mode
            body.classList.remove('dark-mode');
            themeStylesheet.href = '../github-markdown-light.css';
            themeToggle.innerHTML = feather.icons.moon.toSvg();
        } else {
            // Switch to dark mode
            body.classList.add('dark-mode');
            themeStylesheet.href = '../github-markdown-dark.css';
            themeToggle.innerHTML = feather.icons.sun.toSvg();
        }
        
        // Save preference to localStorage
        localStorage.setItem('theme', body.classList.contains('dark-mode') ? 'dark' : 'light');
        
        // Update Feather icons
        feather.replace();
        }
        
        // Add click event to toggle button
        themeToggle.addEventListener('click', toggleTheme);
    </script>
</body>
</html>
